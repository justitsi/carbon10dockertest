{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.requiresFieldsMissingOnBase = void 0;\n\nconst graphql_1 = require(\"graphql\");\n\nconst utils_1 = require(\"../../utils\");\n\nexports.requiresFieldsMissingOnBase = ({\n  schema\n}) => {\n  const errors = [];\n  const types = schema.getTypeMap();\n\n  for (const [typeName, namedType] of Object.entries(types)) {\n    if (!graphql_1.isObjectType(namedType)) continue;\n\n    for (const [fieldName, field] of Object.entries(namedType.getFields())) {\n      const fieldFederationMetadata = utils_1.getFederationMetadata(field);\n      const serviceName = fieldFederationMetadata === null || fieldFederationMetadata === void 0 ? void 0 : fieldFederationMetadata.serviceName;\n      if (!serviceName) continue;\n\n      if (fieldFederationMetadata === null || fieldFederationMetadata === void 0 ? void 0 : fieldFederationMetadata.requires) {\n        const selections = fieldFederationMetadata.requires;\n\n        for (const selection of selections) {\n          const matchingFieldOnType = namedType.getFields()[selection.name.value];\n          const typeFederationMetadata = utils_1.getFederationMetadata(matchingFieldOnType);\n\n          if (typeFederationMetadata === null || typeFederationMetadata === void 0 ? void 0 : typeFederationMetadata.serviceName) {\n            errors.push(utils_1.errorWithCode('REQUIRES_FIELDS_MISSING_ON_BASE', utils_1.logServiceAndType(serviceName, typeName, fieldName) + `requires the field \\`${selection.name.value}\\` to be @external. @external fields must exist on the base type, not an extension.`));\n          }\n        }\n      }\n    }\n  }\n\n  return errors;\n};","map":{"version":3,"sources":["../../../../src/composition/validate/postComposition/requiresFieldsMissingOnBase.ts"],"names":[],"mappings":";;;;;;;AAAA,MAAA,SAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AACA,MAAA,OAAA,GAAA,OAAA,CAAA,aAAA,CAAA;;AAMa,OAAA,CAAA,2BAAA,GAAwD,CAAC;AACpE,EAAA;AADoE,CAAD,KAEhE;AACH,QAAM,MAAM,GAAmB,EAA/B;AAEA,QAAM,KAAK,GAAG,MAAM,CAAC,UAAP,EAAd;;AACA,OAAK,MAAM,CAAC,QAAD,EAAW,SAAX,CAAX,IAAoC,MAAM,CAAC,OAAP,CAAe,KAAf,CAApC,EAA2D;AAEzD,QAAI,CAAC,SAAA,CAAA,YAAA,CAAa,SAAb,CAAL,EAA8B;;AAI9B,SAAK,MAAM,CAAC,SAAD,EAAY,KAAZ,CAAX,IAAiC,MAAM,CAAC,OAAP,CAAe,SAAS,CAAC,SAAV,EAAf,CAAjC,EAAwE;AACtE,YAAM,uBAAuB,GAAG,OAAA,CAAA,qBAAA,CAAsB,KAAtB,CAAhC;AACA,YAAM,WAAW,GAAG,uBAAuB,KAAA,IAAvB,IAAA,uBAAuB,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAA,uBAAuB,CAAE,WAA7C;AAMA,UAAI,CAAC,WAAL,EAAkB;;AAElB,UAAI,uBAAuB,KAAA,IAAvB,IAAA,uBAAuB,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAA,uBAAuB,CAAE,QAA7B,EAAuC;AACrC,cAAM,UAAU,GAAG,uBAAuB,CAAC,QAA3C;;AACA,aAAK,MAAM,SAAX,IAAwB,UAAxB,EAAoC;AAElC,gBAAM,mBAAmB,GAAG,SAAS,CAAC,SAAV,GAC1B,SAAS,CAAC,IAAV,CAAe,KADW,CAA5B;AAGA,gBAAM,sBAAsB,GAAG,OAAA,CAAA,qBAAA,CAAsB,mBAAtB,CAA/B;;AAEA,cAAI,sBAAsB,KAAA,IAAtB,IAAA,sBAAsB,KAAA,KAAA,CAAtB,GAAsB,KAAA,CAAtB,GAAA,sBAAsB,CAAE,WAA5B,EAAyC;AACvC,YAAA,MAAM,CAAC,IAAP,CACE,OAAA,CAAA,aAAA,CACE,iCADF,EAEE,OAAA,CAAA,iBAAA,CAAkB,WAAlB,EAA+B,QAA/B,EAAyC,SAAzC,IACE,wBAAwB,SAAS,CAAC,IAAV,CAAe,KAAK,qFAHhD,CADF;AAOD;AACF;AACF;AACF;AACF;;AAED,SAAO,MAAP;AACD,CA9CY","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.requiresFieldsMissingOnBase = void 0;\nconst graphql_1 = require(\"graphql\");\nconst utils_1 = require(\"../../utils\");\nexports.requiresFieldsMissingOnBase = ({ schema, }) => {\n    const errors = [];\n    const types = schema.getTypeMap();\n    for (const [typeName, namedType] of Object.entries(types)) {\n        if (!graphql_1.isObjectType(namedType))\n            continue;\n        for (const [fieldName, field] of Object.entries(namedType.getFields())) {\n            const fieldFederationMetadata = utils_1.getFederationMetadata(field);\n            const serviceName = fieldFederationMetadata === null || fieldFederationMetadata === void 0 ? void 0 : fieldFederationMetadata.serviceName;\n            if (!serviceName)\n                continue;\n            if (fieldFederationMetadata === null || fieldFederationMetadata === void 0 ? void 0 : fieldFederationMetadata.requires) {\n                const selections = fieldFederationMetadata.requires;\n                for (const selection of selections) {\n                    const matchingFieldOnType = namedType.getFields()[selection.name.value];\n                    const typeFederationMetadata = utils_1.getFederationMetadata(matchingFieldOnType);\n                    if (typeFederationMetadata === null || typeFederationMetadata === void 0 ? void 0 : typeFederationMetadata.serviceName) {\n                        errors.push(utils_1.errorWithCode('REQUIRES_FIELDS_MISSING_ON_BASE', utils_1.logServiceAndType(serviceName, typeName, fieldName) +\n                            `requires the field \\`${selection.name.value}\\` to be @external. @external fields must exist on the base type, not an extension.`));\n                    }\n                }\n            }\n        }\n    }\n    return errors;\n};\n//# sourceMappingURL=requiresFieldsMissingOnBase.js.map"]},"metadata":{},"sourceType":"script"}