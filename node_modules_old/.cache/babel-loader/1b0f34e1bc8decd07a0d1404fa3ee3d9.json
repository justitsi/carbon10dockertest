{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.keyFieldsMissingOnBase = void 0;\n\nconst graphql_1 = require(\"graphql\");\n\nconst utils_1 = require(\"../../utils\");\n\nexports.keyFieldsMissingOnBase = ({\n  schema\n}) => {\n  const errors = [];\n  const types = schema.getTypeMap();\n\n  for (const [typeName, namedType] of Object.entries(types)) {\n    if (!graphql_1.isObjectType(namedType)) continue;\n    const typeFederationMetadata = utils_1.getFederationMetadata(namedType);\n\n    if (typeFederationMetadata === null || typeFederationMetadata === void 0 ? void 0 : typeFederationMetadata.keys) {\n      const allFieldsInType = namedType.getFields();\n\n      for (const [serviceName, selectionSets] of Object.entries(typeFederationMetadata.keys)) {\n        for (const selectionSet of selectionSets) {\n          for (const field of selectionSet) {\n            const name = field.name.value;\n            const matchingField = allFieldsInType[name];\n\n            if (matchingField) {\n              const fieldFederationMetadata = utils_1.getFederationMetadata(matchingField);\n\n              if (fieldFederationMetadata === null || fieldFederationMetadata === void 0 ? void 0 : fieldFederationMetadata.serviceName) {\n                errors.push(utils_1.errorWithCode('KEY_FIELDS_MISSING_ON_BASE', utils_1.logServiceAndType(serviceName, typeName) + `A @key selects ${name}, but ${typeName}.${name} was either created or overwritten by ${fieldFederationMetadata.serviceName}, not ${serviceName}`));\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return errors;\n};","map":{"version":3,"sources":["../../../../src/composition/validate/postComposition/keyFieldsMissingOnBase.ts"],"names":[],"mappings":";;;;;;;AAAA,MAAA,SAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AACA,MAAA,OAAA,GAAA,OAAA,CAAA,aAAA,CAAA;;AAMa,OAAA,CAAA,sBAAA,GAAmD,CAAC;AAC/D,EAAA;AAD+D,CAAD,KAE3D;AACH,QAAM,MAAM,GAAmB,EAA/B;AAEA,QAAM,KAAK,GAAG,MAAM,CAAC,UAAP,EAAd;;AACA,OAAK,MAAM,CAAC,QAAD,EAAW,SAAX,CAAX,IAAoC,MAAM,CAAC,OAAP,CAAe,KAAf,CAApC,EAA2D;AACzD,QAAI,CAAC,SAAA,CAAA,YAAA,CAAa,SAAb,CAAL,EAA8B;AAE9B,UAAM,sBAAsB,GAAG,OAAA,CAAA,qBAAA,CAAsB,SAAtB,CAA/B;;AACA,QAAI,sBAAsB,KAAA,IAAtB,IAAA,sBAAsB,KAAA,KAAA,CAAtB,GAAsB,KAAA,CAAtB,GAAA,sBAAsB,CAAE,IAA5B,EAAkC;AAChC,YAAM,eAAe,GAAG,SAAS,CAAC,SAAV,EAAxB;;AACA,WAAK,MAAM,CAAC,WAAD,EAAc,aAAd,CAAX,IAA2C,MAAM,CAAC,OAAP,CACzC,sBAAsB,CAAC,IADkB,CAA3C,EAEG;AACD,aAAK,MAAM,YAAX,IAA2B,aAA3B,EAA0C;AACxC,eAAK,MAAM,KAAX,IAAoB,YAApB,EAAiD;AAC/C,kBAAM,IAAI,GAAG,KAAK,CAAC,IAAN,CAAW,KAAxB;AAGA,kBAAM,aAAa,GAAG,eAAe,CAAC,IAAD,CAArC;;AAIA,gBAAI,aAAJ,EAAmB;AACjB,oBAAM,uBAAuB,GAAG,OAAA,CAAA,qBAAA,CAAsB,aAAtB,CAAhC;;AAEA,kBAAI,uBAAuB,KAAA,IAAvB,IAAA,uBAAuB,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAA,uBAAuB,CAAE,WAA7B,EAA0C;AACxC,gBAAA,MAAM,CAAC,IAAP,CACE,OAAA,CAAA,aAAA,CACE,4BADF,EAEE,OAAA,CAAA,iBAAA,CAAkB,WAAlB,EAA+B,QAA/B,IACE,kBAAkB,IAAI,SAAS,QAAQ,IAAI,IAAI,yCAAyC,uBAAuB,CAAC,WAAW,SAAS,WAAW,EAHnJ,CADF;AAOD;AACF;AACF;AACF;AACF;AACF;AACF;;AAED,SAAO,MAAP;AACD,CA5CY","sourceRoot":"","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.keyFieldsMissingOnBase = void 0;\nconst graphql_1 = require(\"graphql\");\nconst utils_1 = require(\"../../utils\");\nexports.keyFieldsMissingOnBase = ({ schema, }) => {\n    const errors = [];\n    const types = schema.getTypeMap();\n    for (const [typeName, namedType] of Object.entries(types)) {\n        if (!graphql_1.isObjectType(namedType))\n            continue;\n        const typeFederationMetadata = utils_1.getFederationMetadata(namedType);\n        if (typeFederationMetadata === null || typeFederationMetadata === void 0 ? void 0 : typeFederationMetadata.keys) {\n            const allFieldsInType = namedType.getFields();\n            for (const [serviceName, selectionSets] of Object.entries(typeFederationMetadata.keys)) {\n                for (const selectionSet of selectionSets) {\n                    for (const field of selectionSet) {\n                        const name = field.name.value;\n                        const matchingField = allFieldsInType[name];\n                        if (matchingField) {\n                            const fieldFederationMetadata = utils_1.getFederationMetadata(matchingField);\n                            if (fieldFederationMetadata === null || fieldFederationMetadata === void 0 ? void 0 : fieldFederationMetadata.serviceName) {\n                                errors.push(utils_1.errorWithCode('KEY_FIELDS_MISSING_ON_BASE', utils_1.logServiceAndType(serviceName, typeName) +\n                                    `A @key selects ${name}, but ${typeName}.${name} was either created or overwritten by ${fieldFederationMetadata.serviceName}, not ${serviceName}`));\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    return errors;\n};\n//# sourceMappingURL=keyFieldsMissingOnBase.js.map"]},"metadata":{},"sourceType":"script"}